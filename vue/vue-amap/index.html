<!DOCTYPE HTML><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="description" content="Study hard, day day up!"><meta name="author" content="大西瓜"><meta name="generator" content="Hugo 0.66.0"><title>大西瓜🍉</title><link rel="stylesheet" href="/css/main.css"><link href="/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link rel="icon"><!--[if lt IE 9]>
	<script src="js/ie/html5shiv.js"></script>
	<script src="js/ie/html5shiv.jsrespond.min.js"></script>
	<![endif]--></head><body><div id="wrapper"><header id="header" class="alt"><a href="/" class="logo"><strong>大西瓜</strong> <span>🍉 👶</span></a><nav><a href="#menu">菜单</a></nav></header><nav id="menu"><ul class="links"><li><a href="/">主页</a></li><li><a href="/stories">故事</a></li><li><a href="/javascripts">javascript</a></li><li><a href="/pages">页面展示总结</a></li><li><a href="/react">react</a></li><li><a href="/vue">vue</a></li><li><a href="/svg">svg</a></li><li><a href="/config">配置汇总</a></li></ul><ul class="actions vertical"><li><a href="/blogs" class="button special fit">开始吧</a></li><li><a href="/" class="button fit">Log In</a></li></ul></nav><div id="main" class="alt"><section id="one"><div class="inner"><header class="major"><h1>vue-amap在微信内置浏览器环境的问题</h1><span>Fri, 07 Aug 2020 15:30:26</span></header><h3 id="vue-amap-介绍">vue-amap 介绍</h3><blockquote><p><a href="https://github.com/ElemeFE/vue-amap/"><code>vue-amap</code></a>是饿了么团队用vue2.0+封装的地图插件, 使前端更好的使用高德地图 <a href="https://elemefe.github.io/vue-amap/#/">👇文档地址</a></p></blockquote><h4 id="问题描述">问题描述</h4><blockquote><p>在vue-router设置为history模式的时候, 直接访问需要定位的页面, 可以正确的获取到定位 但是如果使用<code>router.push</code>进行页面的跳转会出现定位无效的情况, 但是用户肯定是通过内部的页面跳转去获取地址定位信息</p></blockquote><p>代码如下:</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#75715e">&lt;!-- 在vue的template中使用vue-amap插件 --&gt;</span>
&lt;<span style="color:#f92672">el-amap</span> <span style="color:#a6e22e">vid</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;amap&#34;</span> <span style="color:#a6e22e">:zoom</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;16&#34;</span> <span style="color:#a6e22e">:center</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mapCenter&#34;</span> <span style="color:#a6e22e">:plugin</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;plugins&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;amap-demo&#34;</span>&gt;
  &lt;<span style="color:#f92672">el-amap-marker</span>
    <span style="color:#a6e22e">v-for</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;(marker, index) in markers&#34;</span>
    <span style="color:#a6e22e">:key</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;index&#34;</span>
    <span style="color:#a6e22e">:position</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;marker.position&#34;</span>
    <span style="color:#a6e22e">:icon</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;marker.icon&#34;</span>
    <span style="color:#a6e22e">:events</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;marker.events&#34;</span>
    <span style="color:#a6e22e">:visible</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;marker.visible&#34;</span>
    <span style="color:#a6e22e">:draggable</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;marker.draggable&#34;</span>
    <span style="color:#a6e22e">clickable</span>
    <span style="color:#a6e22e">:vid</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;index&#34;</span>&gt;
  &lt;/<span style="color:#f92672">el-amap-marker</span>&gt;
&lt;/<span style="color:#f92672">el-amap</span>&gt;
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">// 这是获取定位的方法
</span><span style="color:#75715e"></span><span style="color:#a6e22e">getLocation</span>() {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">that</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>;
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">PLUGIN</span> <span style="color:#f92672">=</span> [
    {
      <span style="color:#a6e22e">pName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Geolocation&#39;</span>,
      <span style="color:#a6e22e">events</span><span style="color:#f92672">:</span> {
        <span style="color:#a6e22e">init</span>(<span style="color:#a6e22e">o</span>) {
          <span style="color:#75715e">// o 是高德地图定位插件实例
</span><span style="color:#75715e"></span>          <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">getCurrentPosition</span>((<span style="color:#a6e22e">status</span>, <span style="color:#a6e22e">result</span>) =&gt; {
            <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">warn</span>(<span style="color:#e6db74">&#39;status, result&#39;</span>, <span style="color:#a6e22e">status</span>, <span style="color:#a6e22e">result</span>);
            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">result</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">position</span>) {
              <span style="color:#a6e22e">that</span>.<span style="color:#a6e22e">geoLoc</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">position</span>;
              <span style="color:#75715e">// that.lat = result.position.lat;
</span><span style="color:#75715e"></span>              <span style="color:#66d9ef">const</span> {
                <span style="color:#a6e22e">street</span>, <span style="color:#a6e22e">streetNumber</span>, <span style="color:#a6e22e">province</span>, <span style="color:#a6e22e">city</span>, <span style="color:#a6e22e">district</span>,
              } <span style="color:#f92672">=</span> <span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">addressComponent</span>;
              <span style="color:#a6e22e">that</span>.<span style="color:#a6e22e">searchOption</span>.<span style="color:#a6e22e">city</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">city</span>;
              <span style="color:#a6e22e">that</span>.<span style="color:#a6e22e">defaultVal</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">province</span><span style="color:#e6db74">}${</span><span style="color:#a6e22e">city</span><span style="color:#e6db74">}${</span><span style="color:#a6e22e">district</span><span style="color:#e6db74">}${</span><span style="color:#a6e22e">street</span><span style="color:#e6db74">}${</span><span style="color:#a6e22e">streetNumber</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
              <span style="color:#a6e22e">that</span>.<span style="color:#a6e22e">mapCenter</span> <span style="color:#f92672">=</span> [<span style="color:#a6e22e">that</span>.<span style="color:#a6e22e">geoLoc</span>.<span style="color:#a6e22e">lng</span>, <span style="color:#a6e22e">that</span>.<span style="color:#a6e22e">geoLoc</span>.<span style="color:#a6e22e">lat</span>];
              <span style="color:#75715e">// self.loaded = true;
</span><span style="color:#75715e"></span>              <span style="color:#a6e22e">that</span>.<span style="color:#a6e22e">$nextTick</span>();
            } <span style="color:#66d9ef">else</span> {
              <span style="color:#a6e22e">that</span>.<span style="color:#a6e22e">defaultVal</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;北京市&#39;</span>;
            }
            <span style="color:#a6e22e">that</span>.<span style="color:#a6e22e">showLoading</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
          });
        },
      },
    },
  ];
  <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">plugins</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">PLUGIN</span>;
},
</code></pre></div><h4 id="解决问题">解决问题</h4><p>在页面跳转的时候使用router的resolve方法跳转</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">// resolve页面跳转可用新页面打开
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">newRouter</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">$router</span>.<span style="color:#a6e22e">resolve</span>({ <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;addressList&#39;</span> });
window.<span style="color:#a6e22e">open</span>(<span style="color:#a6e22e">newRouter</span>.<span style="color:#a6e22e">href</span>, <span style="color:#e6db74">&#39;_self&#39;</span>);
</code></pre></div></div></section></div><footer id="footer"><div class="inner"><ul class="icons"><li><a href="https://www.twitter.com" class="icon alt fa-twitter" target="_blank"><span class="label">Twitter</span></a></li><li><a href="https://www.facebook.com" class="icon alt fa-facebook" target="_blank"><span class="label">Facebook</span></a></li><li><a href="https://www.instagram.com" class="icon alt fa-instagram" target="_blank"><span class="label">Instagram</span></a></li><li><a href="https://www.github.com" class="icon alt fa-github" target="_blank"><span class="label">GitHub</span></a></li><li><a href="https://www.linkedin.com" class="icon alt fa-linkedin" target="_blank"><span class="label">LinkedIn</span></a></li></ul><ul class="copyright"><li>&copy; Company Name</li><li>Design: <a href="https://www.html5up.net">HTML5 UP</a></li></ul></div></footer></div><script src="/js/jquery.min.js"></script><script src="/js/jquery.scrolly.min.js"></script><script src="/js/jquery.scrollex.min.js"></script><script src="/js/skel.min.js"></script><script src="/js/util.js"></script><script src="/js/vanilla-tilt.min.js"></script><script src="/js/main.js"></script></body></html>